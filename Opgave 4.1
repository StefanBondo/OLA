tillid_ola2 <- as.data.frame(tillid_ola2)
tillid_ola2[, 2:14] <- lapply(tillid_ola2[, 2:14], \(x) as.numeric(as.character(x)))

tillid_ola2 <- tillid_ola2 %>%
  mutate(kvartal = ceiling(row_number() / 3)) %>%       
  group_by(kvartal) %>%
  summarise(across(2:14, ~ mean(.x, na.rm = TRUE)), .groups = "drop") %>%
  mutate(across(2:14, ~ round(.x, 2)))

nq <- nrow(tillid_ola2)
år <- 1996 + ((0:(nq - 1)) %/% 4)
q  <- 1 + ((0:(nq - 1)) %% 4)
kvartaler <- paste0(år, "Q", q)

tillid_ola2$kvartal <- paste0(
  1996 + ((tillid_ola2$kvartal - 1) %/% 4),  
  "Q",
  1 + ((tillid_ola2$kvartal - 1) %% 4)       
)

tillid_ola2$kvartal <- kvartaler
tillid_ola2 <- tillid_ola2[, c("kvartal", names(tillid_ola2)[names(tillid_ola2) != "kvartal"])]

tillid_ola2 <- tillid_ola2 %>%
  mutate(
    # hvis formatet er 2021Q1:
    år = as.integer(substr(kvartal, 1, 4)),
    q  = as.integer(substr(kvartal, 6, 6)),
    dato = make_date(år, (q - 1) * 3 + 1, 1)
  )


ggplot(tillid_ola2, aes(x = dato, y = Forbrugertillidsindikatoren)) +
  geom_line() +
  scale_x_date(
    date_breaks = "1 year",           
    date_labels = "%Y",
    minor_breaks = seq(min(tillid_ola2$dato), max(tillid_ola2$dato), by = "3 months")  # tics pr. kvartal
  ) +
  labs(title = "Forbrugertillidsindikator (kvartal)", x = "År (kvartaler markeres)", y = "Indikator") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, margin = margin(t = 5)))


tillid_ola2 %>% slice_max(Forbrugertillidsindikatoren, n = 1)
# 2006Q1 = 12.6

tillid_ola2 %>% slice_min(Forbrugertillidsindikatoren, n = 1)
# 2022Q4 = -32.1
